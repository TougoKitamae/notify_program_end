#+LANGUAGE: ja
#+OPTIONS: toc:nil num:1

* notify_program_end (プログラム終了通知)


**  概要
- 指定したプログラムを実行し，終了時にSlackへ通知を行うCLIコマンド
  - 機能一覧
    - 指定プログラムの実行
    - 同プログラムの終了判定
    - 終了通知と結果をslack指定チャンネルへ送信

      
** 対応環境
- OS
  - macOS
  - Ubuntu

    
- Shell
  - Zsh

** 必要ツール
- slack

  
** 事前準備
*** Slackの設定 (既にされている場合は不要)
- slackアプリの準備
  - slackAPI(https://api.slack.com/apps)にてslackアプリを作成
  - アプリに以下のBot Token Scope(権限)を設定
    | 権限            | 内容                                           |
    |-----------------+------------------------------------------------|
    | channels : read | 通知先チャンネルの選択機能を実装するために追加 |
    | chat : write    | メッセージを送信するために追加                 |
    | users : read    | メンション機能を実装するために追加             |
    |-----------------+------------------------------------------------|
  - 認証トークンの取得
    
    
- アプリのインストール，追加
  - アプリを利用するslackワークスペースへインストール
  - アプリを通知先にするslackチャンネルへ追加
  

*** 環境設定
- ディレクトリの追加
  - Git hub(本ページ)からディレクトリをローカルへ追加


- 環境構築
  - slack設定で取得した認証トークンをcnfig.sh内の変数TOKENへ格納
  - 実行環境にjqコマンドをインストール (既にされている場合は不要)


- PATH設定
  - install.shを実行し，出力内容を.zshenvファイルへ追加

  
** 使用方法
- 実行コマンド
  #+BEGIN_EXAMPLE
  notice [OPTIONS] $program $channel
  #+END_EXAMPLE

  
- OPTIONS
  | オプション | 内容                                                                               |
  |------------+------------------------------------------------------------------------------------|
  | -h         | ヘルプメッセージを出力して終了                                                     |
  | -s         | コマンド，及び指定プログラムをscreen上で実行 (使用しない場合はバックグラウンド実行) |
  | -m $user   | 指定ユーザーをメンションする ($user : slackユーザー名)                                                |
  |------------+------------------------------------------------------------------------------------|

  
- パラメータ
  | パラメータ | 内容                               |
  |------------+------------------------------------|
  | $program   | 実行及び，終了判定するプログラム名 |
  | $channel   | 通知を送るslackチャンネル名        |
  |------------+------------------------------------|


- 注意
  - $programはカレントディレクトリ内のプログラムのみ指定可能
  

** 構成ファイル
[[file:./dir_contents.png]]

